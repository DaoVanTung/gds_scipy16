
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Points Â· Geographic Data Science with PySAL and the pydata stack</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.1.1">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="07_spatial_clustering.html" />
    
    
    <link rel="prev" href="../content/part2/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../distribution.html">
            
                <a href="../distribution.html">
            
                    
                    Distribution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../content/about.html">
            
                <a href="../content/about.html">
            
                    
                    About the authors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../content/infrastructure/">
            
                <a href="../content/infrastructure/">
            
                    
                    Install guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../content/outline.html">
            
                <a href="../content/outline.html">
            
                    
                    Outline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../content/data/">
            
                <a href="../content/data/">
            
                    
                    Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../content/part1/">
            
                <a href="../content/part1/">
            
                    
                    Part I
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../content/part1/00_intro.html">
            
                <a href="../content/part1/00_intro.html">
            
                    
                    Software and Tools Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="01_data_processing.html">
            
                <a href="01_data_processing.html">
            
                    
                    Spatial data processing with PySAL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="02_geovisualization.html">
            
                <a href="02_geovisualization.html">
            
                    
                    Geovisualization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="03_spatial_weights.html">
            
                <a href="03_spatial_weights.html">
            
                    
                    Spatial weights in PySAL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="04_esda.html">
            
                <a href="04_esda.html">
            
                    
                    ESDA with PySAL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="05_spatial_dynamics.html">
            
                <a href="05_spatial_dynamics.html">
            
                    
                    Space-time analysis
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../content/part2/">
            
                <a href="../content/part2/">
            
                    
                    Part II
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.8.1" data-path="06_points.html">
            
                <a href="06_points.html">
            
                    
                    Points
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="07_spatial_clustering.html">
            
                <a href="07_spatial_clustering.html">
            
                    
                    Spatial clustering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="08_spatial_regression.html">
            
                <a href="08_spatial_regression.html">
            
                    
                    Spatial Regression
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../content/infrastructure/workflow.html">
            
                <a href="../content/infrastructure/workflow.html">
            
                    
                    Development notes
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Points</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="point-patterns">Point Patterns</h1>
<blockquote>
<p><a href="../content/part2/06_points.ipynb"><code>IPYNB</code></a></p>
<p><strong>NOTE</strong>: some of this material has been ported and adapted from &quot;Lab 9&quot; in <a href="http://darribas.org/gds15/labs/Lab_09.html" target="_blank">Arribas-Bel (2016)</a>.</p>
</blockquote>
<p>This notebook covers a brief introduction on how to visualize and analyze point patterns. To demonstrate this, we will use a dataset of all the AirBnb listings in the city of Austin (check the Data section for more information about the dataset).</p>
<p>Before anything, let us load up the libraries we will use:</p>
<pre><code class="lang-python">%matplotlib inline

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> geopandas <span class="hljs-keyword">as</span> gpd
<span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> mplleaflet <span class="hljs-keyword">as</span> mpll
</code></pre>
<h2 id="data-preparation">Data preparation</h2>
<p>Let us first set the paths to the datasets we will be using:</p>
<pre><code class="lang-python"><span class="hljs-comment"># Adjust this to point to the right file in your computer</span>
listings_link = <span class="hljs-string">&apos;../data/listings.csv.gz&apos;</span>
</code></pre>
<p>The core dataset we will use is <code>listings.csv</code>, which contains a lot of information about each individual location listed at AirBnb within Austin:</p>
<pre><code class="lang-python">lst = pd.read_csv(listings_link)
lst.info()
</code></pre>
<pre><code>&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;
RangeIndex: 5835 entries, 0 to 5834
Data columns (total 92 columns):
id                                  5835 non-null int64
listing_url                         5835 non-null object
scrape_id                           5835 non-null int64
last_scraped                        5835 non-null object
name                                5835 non-null object
summary                             5373 non-null object
space                               4475 non-null object
description                         5832 non-null object
experiences_offered                 5835 non-null object
neighborhood_overview               3572 non-null object
notes                               2413 non-null object
transit                             3492 non-null object
thumbnail_url                       5542 non-null object
medium_url                          5542 non-null object
picture_url                         5835 non-null object
xl_picture_url                      5542 non-null object
host_id                             5835 non-null int64
host_url                            5835 non-null object
host_name                           5820 non-null object
host_since                          5820 non-null object
host_location                       5810 non-null object
host_about                          3975 non-null object
host_response_time                  4177 non-null object
host_response_rate                  4177 non-null object
host_acceptance_rate                3850 non-null object
host_is_superhost                   5820 non-null object
host_thumbnail_url                  5820 non-null object
host_picture_url                    5820 non-null object
host_neighbourhood                  4977 non-null object
host_listings_count                 5820 non-null float64
host_total_listings_count           5820 non-null float64
host_verifications                  5835 non-null object
host_has_profile_pic                5820 non-null object
host_identity_verified              5820 non-null object
street                              5835 non-null object
neighbourhood                       4800 non-null object
neighbourhood_cleansed              5835 non-null int64
neighbourhood_group_cleansed        0 non-null float64
city                                5835 non-null object
state                               5835 non-null object
zipcode                             5810 non-null float64
market                              5835 non-null object
smart_location                      5835 non-null object
country_code                        5835 non-null object
country                             5835 non-null object
latitude                            5835 non-null float64
longitude                           5835 non-null float64
is_location_exact                   5835 non-null object
property_type                       5835 non-null object
room_type                           5835 non-null object
accommodates                        5835 non-null int64
bathrooms                           5789 non-null float64
bedrooms                            5829 non-null float64
beds                                5812 non-null float64
bed_type                            5835 non-null object
amenities                           5835 non-null object
square_feet                         302 non-null float64
price                               5835 non-null object
weekly_price                        2227 non-null object
monthly_price                       1717 non-null object
security_deposit                    2770 non-null object
cleaning_fee                        3587 non-null object
guests_included                     5835 non-null int64
extra_people                        5835 non-null object
minimum_nights                      5835 non-null int64
maximum_nights                      5835 non-null int64
calendar_updated                    5835 non-null object
has_availability                    5835 non-null object
availability_30                     5835 non-null int64
availability_60                     5835 non-null int64
availability_90                     5835 non-null int64
availability_365                    5835 non-null int64
calendar_last_scraped               5835 non-null object
number_of_reviews                   5835 non-null int64
first_review                        3827 non-null object
last_review                         3829 non-null object
review_scores_rating                3789 non-null float64
review_scores_accuracy              3776 non-null float64
review_scores_cleanliness           3778 non-null float64
review_scores_checkin               3778 non-null float64
review_scores_communication         3778 non-null float64
review_scores_location              3779 non-null float64
review_scores_value                 3778 non-null float64
requires_license                    5835 non-null object
license                             1 non-null float64
jurisdiction_names                  0 non-null float64
instant_bookable                    5835 non-null object
cancellation_policy                 5835 non-null object
require_guest_profile_picture       5835 non-null object
require_guest_phone_verification    5835 non-null object
calculated_host_listings_count      5835 non-null int64
reviews_per_month                   3827 non-null float64
dtypes: float64(20), int64(14), object(58)
memory usage: 4.1+ MB
</code></pre><p>It turns out that one record displays a very odd location and, for the sake of the illustration, we will remove it:</p>
<pre><code class="lang-python">odd = lst.loc[lst.longitude&gt;<span class="hljs-number">-80</span>, [<span class="hljs-string">&apos;longitude&apos;</span>, <span class="hljs-string">&apos;latitude&apos;</span>]]
odd
</code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5832</th>
      <td>-5.093682</td>
      <td>43.214991</td>
    </tr>
  </tbody>
</table>
</div>




<pre><code class="lang-python">lst = lst.drop(odd.index)
</code></pre>
<h2 id="point-visualization">Point Visualization</h2>
<p>The most straighforward way to get a first glimpse of the distribution of the data is to plot their latitude and longitude:</p>
<pre><code class="lang-python">sns.jointplot?
</code></pre>
<pre><code class="lang-python">sns.jointplot(x=<span class="hljs-string">&quot;longitude&quot;</span>, y=<span class="hljs-string">&quot;latitude&quot;</span>, data=lst);
</code></pre>
<p><img src="06_points_files/06_points_14_0.png" alt="png"></p>
<p>Now this does not neccesarily tell us much about the dataset or the distribution of locations within Austin. There are two main challenges in interpreting the plot: one, there is lack of context, which means the points are not identifiable over space (unless you are so familiar with lon/lat pairs that they have a clear meaning to you); and two, in the center of the plot, there are so many points that it is hard to tell any pattern other than a big blurb of blue.</p>
<p>Let us first focus on the first problem, geographical context. The quickest and easiest way to provide context to this set of points is to overlay a general map. If we had an image with the map or a set of several data sources that we could aggregate to create a map, we could build it from scratch. But in the XXI Century, the easiest is to overlay our point dataset on top of a web map. In this case, we will use <a href="http://leafletjs.com/" target="_blank">Leaflet</a>, and we will convert our underlying <code>matplotlib</code> points with <code>mplleaflet</code>. The full dataset (+5k observations) is a bit too much for leaflet to plot it directly on screen, so we will obtain a random sample of 100 points:</p>
<pre><code class="lang-python"><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> `mpll.display` turned off to be able to compile the website,</span>
<span class="hljs-comment">#       comment out the last line of this cell for rendering Leaflet map.</span>
rids = np.arange(lst.shape[<span class="hljs-number">0</span>])
np.random.shuffle(rids)
f, ax = plt.subplots(<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>))
lst.iloc[rids[:<span class="hljs-number">100</span>], :].plot(kind=<span class="hljs-string">&apos;scatter&apos;</span>, x=<span class="hljs-string">&apos;longitude&apos;</span>, y=<span class="hljs-string">&apos;latitude&apos;</span>, \
                      s=<span class="hljs-number">30</span>, linewidth=<span class="hljs-number">0</span>, ax=ax);
<span class="hljs-comment">#mpll.display(fig=f,)</span>
</code></pre>
<p><img src="06_points_files/06_points_16_0.png" alt="png"></p>
<p>This map allows us to get a much better sense of where the points are and what type of location they might be in. For example, now we can see that the big blue blurb has to do with the urbanized core of Austin.</p>
<h3 id="bokeh-alternative"><code>bokeh</code> alternative</h3>
<p>Leaflet is not the only technology to display data on maps, although it is probably the default option in many cases. When the data is larger than &quot;acceptable&quot;, we need to resort to more technically sophisticated alternatives. One option is provided by <code>bokeh</code> and its <code>datashaded</code> submodule (see <a href="https://anaconda.org/jbednar/nyc_taxi/notebook" target="_blank">here</a> for a very nice introduction to the library, from where this example has been adapted).</p>
<p>Before we delve into <code>bokeh</code>, let us reproject our original data (lon/lat coordinates) into Web Mercator, as <code>bokeh</code> will expect them. To do that, we turn the coordinates into a <code>GeoSeries</code>:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> shapely.geometry <span class="hljs-keyword">import</span> Point
xys_wb = gpd.GeoSeries(lst[[<span class="hljs-string">&apos;longitude&apos;</span>, <span class="hljs-string">&apos;latitude&apos;</span>]].apply(Point, axis=<span class="hljs-number">1</span>), \
                      crs=<span class="hljs-string">&quot;+init=epsg:4326&quot;</span>)
xys_wb = xys_wb.to_crs(epsg=<span class="hljs-number">3857</span>)
x_wb = xys_wb.apply(<span class="hljs-keyword">lambda</span> i: i.x)
y_wb = xys_wb.apply(<span class="hljs-keyword">lambda</span> i: i.y)
</code></pre>
<p>Now we are ready to setup the plot in <code>bokeh</code>:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> bokeh.plotting <span class="hljs-keyword">import</span> figure, output_notebook, show
<span class="hljs-keyword">from</span> bokeh.tile_providers <span class="hljs-keyword">import</span> STAMEN_TERRAIN
output_notebook()

minx, miny, maxx, maxy = xys_wb.total_bounds
y_range = miny, maxy
x_range = minx, maxx

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">base_plot</span><span class="hljs-params">(tools=<span class="hljs-string">&apos;pan,wheel_zoom,reset&apos;</span>,plot_width=<span class="hljs-number">600</span>, plot_height=<span class="hljs-number">400</span>, **plot_args)</span>:</span>
    p = figure(tools=tools, plot_width=plot_width, plot_height=plot_height,
        x_range=x_range, y_range=y_range, outline_line_color=<span class="hljs-keyword">None</span>,
        min_border=<span class="hljs-number">0</span>, min_border_left=<span class="hljs-number">0</span>, min_border_right=<span class="hljs-number">0</span>,
        min_border_top=<span class="hljs-number">0</span>, min_border_bottom=<span class="hljs-number">0</span>, **plot_args)

    p.axis.visible = <span class="hljs-keyword">False</span>
    p.xgrid.grid_line_color = <span class="hljs-keyword">None</span>
    p.ygrid.grid_line_color = <span class="hljs-keyword">None</span>
    <span class="hljs-keyword">return</span> p

options = dict(line_color=<span class="hljs-keyword">None</span>, fill_color=<span class="hljs-string">&apos;#800080&apos;</span>, size=<span class="hljs-number">4</span>)
</code></pre>
<pre><code>&lt;div class=&quot;bk-banner&quot;&gt;
    &lt;a href=&quot;http://bokeh.pydata.org&quot; target=&quot;_blank&quot; class=&quot;bk-logo bk-logo-small bk-logo-notebook&quot;&gt;&lt;/a&gt;
    &lt;span id=&quot;efa98bda-2ccf-4dbf-ae97-94033d60c79b&quot;&gt;Loading BokehJS ...&lt;/span&gt;
&lt;/div&gt;
</code></pre><p>And good to go for mapping!</p>
<pre><code class="lang-python"><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> `show` turned off to be able to compile the website,</span>
<span class="hljs-comment">#       comment out the last line of this cell for rendering.</span>
p = base_plot()
p.add_tile(STAMEN_TERRAIN)
p.circle(x=x_wb, y=y_wb, **options)
<span class="hljs-comment">#show(p)</span>
</code></pre>
<pre><code>&lt;bokeh.models.renderers.GlyphRenderer at 0x1052bb5f8&gt;
</code></pre><p>As you can quickly see, <code>bokeh</code> is substantially faster at rendering larger amounts of data.</p>
<p>The second problem we have spotted with the first scatter is that, when the number of points grows, at some point it becomes impossible to discern anything other than a big blur of color. To some extent, interactivity gets at that problem by allowing the user to zoom in until every point is an entity on its own. However, there exist techniques that allow to summarize the data to be able to capture the overall pattern at once. Traditionally, kernel density estimation (KDE) has been one of the most common solutions by approximating a continuous surface of point intensity. In this context, however, we will explore a more recent alternative suggested by the <a href="https://github.com/bokeh/datashader" target="_blank"><code>datashader</code></a> library (see the <a href="http://www.crest.iu.edu/publications/prints/2014/Cottam2014OutOfCore.pdf" target="_blank">paper</a> if interested in more details).</p>
<p>Arguably, our dataset is not large enough to justify the use of a reduction technique like datashader, but we will create the plot for the sake of the illustration. Keep in mind, the usefulness of this approach increases the more points you need to be plotting.</p>
<pre><code class="lang-python"><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> `show` turned off to be able to compile the website,</span>
<span class="hljs-comment">#       comment out the last line of this cell for rendering.</span>

<span class="hljs-keyword">import</span> datashader <span class="hljs-keyword">as</span> ds
<span class="hljs-keyword">from</span> datashader.callbacks <span class="hljs-keyword">import</span> InteractiveImage
<span class="hljs-keyword">from</span> datashader.colors <span class="hljs-keyword">import</span> viridis
<span class="hljs-keyword">from</span> datashader <span class="hljs-keyword">import</span> transfer_functions <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> bokeh.tile_providers <span class="hljs-keyword">import</span> STAMEN_TONER

p = base_plot()
p.add_tile(STAMEN_TONER)

pts = pd.DataFrame({<span class="hljs-string">&apos;x&apos;</span>: x_wb, <span class="hljs-string">&apos;y&apos;</span>: y_wb})
pts[<span class="hljs-string">&apos;count&apos;</span>] = <span class="hljs-number">1</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_image90</span><span class="hljs-params">(x_range, y_range, w, h)</span>:</span>
    cvs = ds.Canvas(plot_width=w, plot_height=h, x_range=x_range, y_range=y_range)
    agg = cvs.points(pts, <span class="hljs-string">&apos;x&apos;</span>, <span class="hljs-string">&apos;y&apos;</span>,  ds.count(<span class="hljs-string">&apos;count&apos;</span>))
    img = tf.interpolate(agg.where(agg &gt; np.percentile(agg,<span class="hljs-number">90</span>)), \
                         cmap=viridis, how=<span class="hljs-string">&apos;eq_hist&apos;</span>)
    <span class="hljs-keyword">return</span> tf.dynspread(img, threshold=<span class="hljs-number">0.1</span>, max_px=<span class="hljs-number">4</span>)

<span class="hljs-comment">#InteractiveImage(p, create_image90)</span>
</code></pre>
<p>The key advandage of <code>datashader</code> is that is decouples the point processing from the plotting. That is the bit that allows it to be scalable to truly large datasets (e.g. millions of points). Essentially, the approach is based on generating a very fine grid, counting points within pixels, and encoding the count into a color scheme. In our map, this is not particularly effective because we do not have too many points (the previous plot is probably a more effective one) and esssentially there is a pixel per location of every point. However, hopefully this example shows how to create this kind of scalable maps.</p>
<h2 id="kernel-density-estimation">Kernel Density Estimation</h2>
<p>A common alternative when the number of points grows is to replace plotting every single point by estimating the continuous observed probability distribution. In this case, we will not be visualizing the points themselves, but an abstracted surface that models the probability of point density over space. The most commonly used method to do this is the so called kernel density estimate (KDE). The idea behind KDEs is to count the number of points in a continious way. Instead of using discrete counting, where you include a point in the count if it is inside a certain boundary and ignore it otherwise, KDEs use functions (kernels) that include points but give different weights to each one depending of how far of the location where we are counting the point is.</p>
<p>Creating a KDE is very straightfoward in Python. In its simplest form, we can run the following single line of code:</p>
<pre><code class="lang-python">sns.kdeplot(lst[<span class="hljs-string">&apos;longitude&apos;</span>], lst[<span class="hljs-string">&apos;latitude&apos;</span>], shade=<span class="hljs-keyword">True</span>, cmap=<span class="hljs-string">&apos;viridis&apos;</span>);
</code></pre>
<p><img src="06_points_files/06_points_27_0.png" alt="png"></p>
<p>Now, if we want to include additional layers of data to provide context, we can do so in the same way we would layer up different elements in <code>matplotlib</code>. Let us load first the Zip codes in Austin, for example:</p>
<pre><code class="lang-python">zc = gpd.read_file(<span class="hljs-string">&apos;../data/Zipcodes.geojson&apos;</span>)
zc.plot();
</code></pre>
<p><img src="06_points_files/06_points_29_0.png" alt="png"></p>
<p>And, to overlay both layers:</p>
<pre><code class="lang-python">f, ax = plt.subplots(<span class="hljs-number">1</span>, figsize=(<span class="hljs-number">9</span>, <span class="hljs-number">9</span>))

zc.plot(color=<span class="hljs-string">&apos;white&apos;</span>, linewidth=<span class="hljs-number">0.1</span>, ax=ax)

sns.kdeplot(lst[<span class="hljs-string">&apos;longitude&apos;</span>], lst[<span class="hljs-string">&apos;latitude&apos;</span>], \
            shade=<span class="hljs-keyword">True</span>, cmap=<span class="hljs-string">&apos;Purples&apos;</span>, \
            ax=ax);

ax.set_axis_off()
plt.axis(<span class="hljs-string">&apos;equal&apos;</span>)
plt.show()
</code></pre>
<p><img src="06_points_files/06_points_31_0.png" alt="png"></p>
<!--
## `bokeh` alternative

pts.head()

from sklearn.neighbors import KernelDensity
from sklearn.grid_search import GridSearchCV

# Setup kernel
kde = KernelDensity(metric='euclidean',
                    kernel='gaussian', algorithm='ball_tree')
# Bandwidth selection
gs = GridSearchCV(kde, \
                {'bandwidth': np.linspace(0.1, 1.0, 30)}, \
                cv=3)
%time cv = gs.fit(pts[['x', 'y']].values)
bw = cv.best_params_['bandwidth']
kde.bandwidth = bw
# Fit the KDE
kde.fit(pts[['x', 'y']].values)

# Build a mesh
minX, minY = pts[['x', 'y']].values.min(axis=0)
maxX, maxY = pts[['x', 'y']].values.max(axis=0)
bbox = [minX, minY, maxX, maxY]
mn = 100
mx = np.linspace(minX, maxX, mn)
my = np.linspace(minY, maxY, mn)
mxx, myy = np.meshgrid(mx, my)
mxxyy = np.hstack((mxx.reshape(-1, 1), myy.reshape(-1, 1)))
# Fit to the KDE
d = kde.score_samples(mxxyy).reshape(mn, mn)

print pts.min()['x'], pts.min()['y']

print pts.max()['x'], pts.max()['y']

mxxyy.max(axis=0)

from bokeh.plotting import figure, show

p = base_plot()
p.add_tile(STAMEN_TERRAIN)

p.image(image=[d], x=minX, y=minY, dw=maxX-minX, dh=maxY-minY, \
        alpha=0.001, palette="Blues9")

show(p)
-->
<h2 id="exercise">Exercise</h2>
<blockquote>
<p><em>Split the dataset by type of property and create a map for the five most common types.</em></p>
</blockquote>
<p>Consider the following sorting of property types:</p>
<pre><code class="lang-python">lst.property_type.groupby(lst.property_type)\
                 .count()\
                 .sort_values(ascending=<span class="hljs-keyword">False</span>)
</code></pre>
<pre><code>property_type
House              3549
Apartment          1855
Condominium         106
Loft                 83
Townhouse            57
Other                47
Bed &amp; Breakfast      37
Camper/RV            34
Bungalow             18
Cabin                17
Tent                 11
Villa                 7
Treehouse             7
Earth House           2
Chalet                1
Hut                   1
Boat                  1
Tipi                  1
Name: property_type, dtype: int64
</code></pre><pre><code class="lang-python">

</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../content/part2/" class="navigation navigation-prev " aria-label="Previous page: Part II">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="07_spatial_clustering.html" class="navigation navigation-next " aria-label="Next page: Spatial clustering">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Points","level":"1.8.1","depth":2,"next":{"title":"Spatial clustering","level":"1.8.2","depth":2,"path":"ipynb_md/07_spatial_clustering.md","ref":"ipynb_md/07_spatial_clustering.md","articles":[]},"previous":{"title":"Part II","level":"1.8","depth":1,"path":"content/part2/README.md","ref":"content/part2/README.md","articles":[{"title":"Points","level":"1.8.1","depth":2,"path":"ipynb_md/06_points.md","ref":"ipynb_md/06_points.md","articles":[]},{"title":"Spatial clustering","level":"1.8.2","depth":2,"path":"ipynb_md/07_spatial_clustering.md","ref":"ipynb_md/07_spatial_clustering.md","articles":[]},{"title":"Spatial Regression","level":"1.8.3","depth":2,"path":"ipynb_md/08_spatial_regression.md","ref":"ipynb_md/08_spatial_regression.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["katex","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"katex":{},"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Serif","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Geographic Data Science with PySAL and the pydata stack","gitbook":">=3.0.0","description":"Booklet with material for the workshop at Scipy'16"},"file":{"path":"ipynb_md/06_points.md","mtime":"2016-06-25T00:42:20.000Z","type":"markdown"},"gitbook":{"version":"3.1.1","time":"2016-06-25T11:14:31.398Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

